---
import { getIcon } from '../utils/icons';

interface Props {
    item: {
        title: string;
        institution: string;
        period: string;
        description: string;
        place: string;
        mode?: string;
        type: 'job' | 'study';
        technologies?: string[];
    };
}
const { item } = Astro.props;

// Mapeo de instituciones a archivos de imagen
const logoMap: Record<string, string> = {
    'KAIROS Digital Solutions': '/experience/kairosds.jpeg',
    'NTT DATA': '/experience/nttdata.jpeg',
    'Cipher': '/experience/cipher.jpeg',
    'Codigo10 Soluciones Informaticas': '/experience/codigo-10.jpeg',
    'Mobisoft Software': '/experience/mobisoft.jpeg',
    'Labaqua': '/experience/labaqua.jpeg',
    'IES Mare Nostrum': '/education/ies-mare-nostrum.jpeg',
    'CIP FP Batoi': '/education/cip-fp-batoi.png',
    'Cámara de comercio': '/education/camara-comercio-alicante.png',
};

const logoSrc = logoMap[item.institution];
---
<div class="relative pl-6 sm:pl-8 border-l-2 border-slate-900 pb-8 sm:pb-12 last:pb-0 group">
    <div class="absolute -left-2 sm:-left-2.5 top-2 w-3 h-3 sm:w-4 sm:h-4 bg-white rounded-full border-2 border-slate-900 box-content group-hover:bg-accent transition-colors"></div>
    
    <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between mb-2 gap-2">
        <div class="flex items-center gap-2 sm:gap-3">
            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-white border-2 flex-none border-slate-900 rounded-3xl flex items-center justify-center overflow-hidden shadow-[2px_2px_0px_0px_rgba(26,26,26,1)]">
                {logoSrc ? (
                    <img 
                        src={logoSrc} 
                        alt={item.institution} 
                        class="w-full h-full object-cover"
                    />
                ) : (
                    <span class="text-xs sm:text-sm font-bold text-slate-900">
                        {item.institution.substring(0, 2).toUpperCase()}
                    </span>
                )}
            </div>
            <h3 class="text-base sm:text-lg font-bold font-heading text-slate-900 leading-tight">{item.title}</h3>
        </div>
        <span class="text-xs sm:text-sm font-bold text-slate-900 bg-accent px-2 py-1 rounded border-2 border-slate-900 shadow-[2px_2px_0px_0px_rgba(26,26,26,1)] self-start">{item.period}</span>
    </div>
    
    <div class="text-sm sm:text-base font-bold text-slate-700 mb-2 sm:mb-3 pl-10 sm:pl-12 leading-tight">
        {item.institution} <span class="text-slate-500 font-medium text-xs sm:text-sm">• {item.place} {item.mode && `• ${item.mode}`}</span>
    </div>

    {item.technologies && item.technologies.length > 0 && (
        <div class="flex flex-wrap gap-1.5 sm:gap-2 pl-10 sm:pl-12 mb-2 sm:mb-3">
            {item.technologies.map(tech => {
                const icon = getIcon(tech);
                return (
                    <span class="px-1.5 py-0.5 sm:px-2 sm:py-1 bg-white text-slate-900 text-[10px] sm:text-xs font-bold rounded-3xl flex items-center gap-1 border-2 border-slate-900 shadow-[1px_1px_0px_0px_rgba(26,26,26,1)]">
                        {icon && <span class="w-2.5 h-2.5 sm:w-3 sm:h-3 text-slate-900 [&>svg]:fill-current" set:html={icon.svg} />}
                        {tech}
                    </span>
                );
            })}
        </div>
    )}
    
    <div class="pl-10 sm:pl-12">
        <p class="text-slate-600 leading-relaxed text-sm sm:text-base mb-3 sm:mb-4 font-medium">
            {item.description}
        </p>
    </div>
</div>
