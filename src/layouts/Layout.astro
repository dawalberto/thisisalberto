---
import { ClientRouter } from 'astro:transitions';
import Footer from '../components/Footer.astro';
import Navbar from '../components/Navbar.astro';
import ScrollToTop from '../components/ScrollToTop.astro';
import { getLangFromUrl } from '../i18n/utils';
import '../styles/global.css';

interface Props {
	title: string;
    description?: string;
    keywords?: string;
    image?: string;
    fullWidth?: boolean;
    lang?: 'en' | 'es';
}

const { 
    title,
    description: propDescription,
    keywords: propKeywords,
    image = '/og-image.png',
    fullWidth = false, 
    lang: propLang 
} = Astro.props;
const lang = propLang || getLangFromUrl(Astro.url);

const description = propDescription || (lang === 'es' 
    ? 'Portfolio de Alberto García Sola - Desarrollador Web Frontend especializado en React, TypeScript y tecnologías modernas. Descubre mis proyectos y experiencia.'
    : 'Alberto García Sola - Frontend Web Developer specialized in React, TypeScript and modern web technologies. Explore my projects and experience.');

const keywords = propKeywords || (lang === 'es'
    ? 'desarrollador web, frontend, React, TypeScript, Astro, JavaScript, portfolio, Alberto García'
    : 'web developer, frontend, React, TypeScript, Astro, JavaScript, portfolio, Alberto García');

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImageURL = new URL(image, Astro.site);

const gaId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID || 'G-LELLMXG5XK';
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="author" content="Alberto García Sola" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalURL} />
		
		<!-- Favicons -->
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		<link rel="manifest" href="/site.webmanifest" />
		<meta name="theme-color" content="#ffd93d" />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImageURL} />
		<meta property="og:locale" content={lang === 'es' ? 'es_ES' : 'en_US'} />
		<meta property="og:site_name" content="Alberto García Sola" />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={canonicalURL} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={ogImageURL} />
		
		<!-- Alternate Languages -->
		{lang === 'en' ? (
			<link rel="alternate" hreflang="es" href={new URL('/es' + Astro.url.pathname, Astro.site)} />
		) : (
			<link rel="alternate" hreflang="en" href={new URL(Astro.url.pathname.replace('/es', ''), Astro.site)} />
		)}
		<link rel="alternate" hreflang="x-default" href={new URL(Astro.url.pathname.replace('/es', ''), Astro.site)} />
		
        <ClientRouter />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400;500&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
		
		<!-- Google Analytics -->
		{gaId && (
			<>
				<script type="text/partytown" async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
				<script type="text/partytown" define:vars={{ gaId }}>
					window.dataLayer = window.dataLayer || [];
					function gtag(){dataLayer.push(arguments);}
					gtag('js', new Date());
					gtag('config', gaId);
				</script>
			</>
		)}
		
		<slot name="schema" />
	</head>
	<body class="bg-white text-slate-900 font-sans antialiased">
        <Navbar />
		<main class={`min-h-screen ${fullWidth ? 'w-full' : 'max-w-4xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 pt-24 sm:pt-28 md:pt-32 lg:pt-36 pb-8 sm:pb-10 md:pb-12'}`}>
			<slot />
		</main>
        <Footer />
        <ScrollToTop />
	</body>
</html>
